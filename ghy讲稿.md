在大规模多处理器系统上应用广播侦听协议是会遇到一些问题的，我把这些问题总结为了两点：

- 第一点：**一致性操作之间以及一致性操作与外存访问之间竞争总线带宽。**这是由于广播侦听的特点造成的，假设一个处理器发出了一个一致性请求，那么这个请求需要在总线上传递给所有的处理器。请求数量至少随着处理器个数的增多而线性增长，随着处理器的增多，总线上会产生拥堵。
- 第二点：**一致性控制器与处理器竞争cache访问带宽。**每个处理器都有一个一致性控制器，用来侦听总线请求。如果总线上有一个其它处理器发出的无效块的请求，那么一致性控制器就要访问cache，查询cache里是否有这个块，如果有就无效掉。cache一般是单端口RAM结构，一个时刻只能有一个主端读，所以一致性控制器读的时候处理器核心就读不了，造成处理器pipline暂停。随着总线事务的增多，这个问题会越来越严重。

我们发现这两个问题是由于**所有**一致性操作都需要发送给**每一个**处理器所造成的。那么可不可以**只向需要接收一致性消息的处理器发送一致性消息呢？**这就是目录式协议提出的背景。

为了实现针对性发送请求，我们需要一个数据结构来保存对每一个数据块，哪个cache拥有该数据块的副本，以及cache中该数据块的状态，这个数据结构称之为目录。对某数据块进行一致性操作时检索目录，只向拥有该数据块的缓存发送消息。

我们来看一个写实例，系统中有三个处理器与一个目录。初始时P0，P2均有块B，状态为Share，且目录中保存有块B的信息。之后P0发出一个写块B的请求，cache发现块B状态为S，于是向目录发出请求，请求将其它cache中的块B无效化。目录发现除了P0，P2还拥有块B，于是向P2发送无效化请求。P2无效完块B后返回确认信息给目录和P0，目录更新块B的信息，P0写块B，块B的状态也变为了Modify。

通过上面这个实例我们发现目录显著减少了互联网络上的通信流量。现在的问题是目录应该保存在哪里呢？如果像例子里一样有一个集中式的目录，那么所有处理器访问目录的带宽将会是瓶颈。一种流行的方案是分布式共享存储架构，即内存与目录是分布式的，物理地址以某一粒度跨内存交叉编址，每一个节点的内存与目录映射到物理地址空间的一部分，节点间采用点对点互联网络。DSM可以显著降低处理器与目录的通信流量。

